(function(){var e=function(){var e=function(e){var n=function(){},r=e.url||"",o=e.async||!0,i=e.method||"GET",a=e.data||null,l=e.success||n,s=e.failure||n;if(i=i.toUpperCase(),"GET"===i&&a){var u=null;if("object"==typeof a){u=new Array;for(var c in a)u.push(c+"="+a[c])}u&&(r=(r.indexOf("?")==-1?"?":"&")+u.join("&"),a=null)}var d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return d.onreadystatechange=function(){t(d,l,s)},d.open(i,r,o),"POST"===i&&d.setRequestHeader("Content-type","application/x-www-form-urlencoded;"),d.send(a),d},t=function(e,t,n){if(4==e.readyState){var r=e.status;r>=200&&r<300?t(e):n(e)}};return e}(),t={ajax:e,jsonp:function(e){var n=function(){},r=e.params||{},o=e.url,i=e.scriptCallback||"callback"+t.CGUI(),a=e.success||n,l=e.failure||n;if(!o)return void l(new Error("url is undefined."));var s=["callback="+i];for(var u in r)s.push(u+"="+r[u]);var o=o+(o.indexOf("?")==-1?"?":"&")+s.join("&");r=null;var c=document.createElement("script");window[i]=function(){a.apply(window,arguments),window[i]=null,document.body.removeChild(c),c=null},c.src=o,document.body.appendChild(c)},emptyFn:function(){},CGUI:function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+e()+e()+e()}},n=this,r=function(e){o.call(this),"test"===e?this.host="https://testsso.rabbitpre.com":"beta"===e&&(this.host="https://betasso.rabbitpre.com")};r.prototype.iframeEvents=[],r.prototype.host="https://sso.rabbitpre.com",r.prototype.loginId=null,r.prototype.registerId=null,r.prototype.callBack=null,r.prototype.loginCallBack=null,r.prototype.registerCallBack=null,r.prototype.forgetCallBack=t.emptyFn,r.prototype.onIframe=function(e,n){if(e){n=n||t.emptyFn;var r=["on"+e.toLowerCase(),n];this.iframeEvents.push(r)}},r.prototype.forget=function(e){this.forgetCallBack=e||t.emptyFn},r.prototype.register=function(e,n){if(e){var r=null,o=null,i=typeof e;if("string"===i&&(this.registerId=e),"object"===i){if(!e.id)return;this.registerId=e.id,r=e.stylesheet,o=e.promise,regfrom=e.regfrom}this.callBack=this.registerCallBack=n||t.emptyFn,s.call(this,this.registerId,"/register_ii",{stylesheet:r,promise:o,regfrom:regfrom})}},r.prototype.login=function(e,n){if(e){var r=null,o=null,i=typeof e;if("string"===i&&(this.loginId=e),"object"===i){if(!e.id)return;this.loginId=e.id,r=e.stylesheet,o=e.forget}this.callBack=this.loginCallBack=n||t.emptyFn,s.call(this,this.loginId,"/login_ii",{stylesheet:r,forget:o})}},r.prototype.loginOut=function(e){e=e||t.emptyFn,l.call(this,e)},r.prototype.checkStatus=function(e){e=e||t.emptyFn,a.call(this,e)};var o=function(){if(_this=this,window){var e=function(e){if(e.origin.indexOf(_this.host)>=0){try{e.payload=JSON.parse(e.data)}catch(t){}if(!e.payload||!e.payload.eventId)return _this.callBack(e.payload);var n=e.payload.payload?e.payload.payload.ticket:null,r=e.payload.errcode>0?e.payload:null;"REGISTER"===e.payload.eventId?_this.registerCallBack(r,n):"LOGIN"===e.payload.eventId||"CHECK"===e.payload.eventId?_this.loginCallBack(r,n):"FORGET"===e.payload.eventId&&_this.forgetCallBack()}};"undefined"!=typeof window.addEventListener?window.addEventListener("message",e):"undefined"!=typeof window.attachEvent&&window.attachEvent("onmessage",e)}},i=function(e,t,n){e[t]=n},a=function(e){t.jsonp({url:this.host+"/checkStatus",success:function(t){if("CHECK"!==t.eventId)return e("error request");if(t.errcode>0)return e(t);var n=t.payload?t.payload.ticket:null;e(null,n)},failure:function(t){e(t)}})},l=function(e){t.jsonp({url:this.host+"/api/user/logout",success:function(n){if(n.errcode>0||"LOGINOUT"!==n.eventId)return e(n);var r=n.payload?n.payload.logoutUrlList:[];if(r)for(var o=0;o<r.length;o++)r[o]&&t.jsonp({url:r[o]});e(null)},failure:function(t){e(t)}})},s=function(e,t,n){if(document){var r=document.getElementById(e);if(!r)return;var o=e+"_iframe_killerwhale",a=document.getElementById(o);if(a)return;if(queryParams=["?t="+(new Date).getTime()],n)for(var l in n){var s=n[l];s&&queryParams.push(l+"="+encodeURIComponent(s))}queryUri=queryParams.join("&"),a=document.createElement("iframe");var u=this.host+t+queryUri;a.src=u,a.id=o,a.width="400px",a.height="410px",a.scrolling="no",a.setAttribute("frameBorder",0),a.border="0";for(var c=this.iframeEvents,d=0;d<c.length;d++){var p=c[d];i(a,p[0],function(t){p[1](t,o,e)})}r.appendChild(a)}};KillerWhale={SSO:r},KillerWhale.VERSION="0.0.1","undefined"!=typeof exports?"undefined"!=typeof module&&module.exports?exports=module.exports=KillerWhale:exports.KillerWhale=KillerWhale:n.KillerWhale=KillerWhale,"function"==typeof define&&define.amd&&define("KillerWhale",[],function(){return KillerWhale})}).call(this);